<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>四 制作留言本 - SpeedPHP 文档</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/bootstrap-table.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/prettify.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <!-- <link rel="stylesheet" href="../css/highlight.css"> -->
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
        <script src="../js/jquery.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script src="../js/bootstrap-table.min.js"></script>
        <!-- <script src="../js/highlight.pack.js"></script> -->
        <script src="../js/prettify.min.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">SpeedPHP 文档</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Home</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">快速入门 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%B8%80%E3%80%81%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8SpeedPHP/">一 开始使用SpeedPHP</a>
</li>
                            
<li >
    <a href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%BA%8C%E3%80%81Hello%20World/">二 Hello World</a>
</li>
                            
<li >
    <a href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%B8%89%E3%80%81%E7%90%86%E8%A7%A3MVC/">三 理解MVC</a>
</li>
                            
<li class="active">
    <a href="./">四 制作留言本</a>
</li>
                            
<li >
    <a href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%BA%94%E3%80%81%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E5%8F%8AAjax/">五 数据操作及Ajax</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">框架概述 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-SAE%E5%B9%B3%E5%8F%B0%E4%BD%BF%E7%94%A8/">SAE平台使用</a>
</li>
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-%E7%89%88%E6%9D%83%E5%8F%8A%E5%BC%80%E6%BA%90%E5%8D%8F%E8%AE%AE/">版权及开源协议</a>
</li>
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-%E7%BC%96%E7%A0%81%E7%89%88%E6%9C%AC/">编码版本</a>
</li>
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">开发环境</a>
</li>
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-%E7%89%B9%E8%89%B2/">特色</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">开发指南 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%91%BD%E5%90%8D%E5%BB%BA%E8%AE%AE/">命名建议</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%AE%89%E5%85%A8%E5%BB%BA%E8%AE%AE/">安全建议</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E7%A8%8B%E5%BA%8F%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/">程序目录结构</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E6%9E%B6%E6%9E%84%E5%8F%8A%E6%89%A9%E5%B1%95/">架构及扩展</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/">开发流程</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%91%BD%E5%90%8D%E5%BB%BA%E8%AE%AE/">命名建议</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E6%A8%A1%E5%9D%97modules/">模块modules</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89/">用户自定义</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">访问交互 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-session%EF%BC%8Fcookie/">session／cookie</a>
</li>
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E5%8F%8A%E8%8E%B7%E5%8F%96%24_GET%EF%BC%8F%24_POST%E7%9A%84%E6%95%B0%E6%8D%AE/">表单提交及获取$_GET／$_POST的数据</a>
</li>
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%89%B9%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">模板引擎特性和使用方法</a>
</li>
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-%E4%BD%BF%E7%94%A8frameset/">使用frameset</a>
</li>
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-%E4%BC%AA%E9%9D%99%E6%80%81%E5%8F%8AURL%E8%B7%B3%E8%BD%AC/">伪静态及URL跳转</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">数据操作 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-SQL%E6%94%AF%E6%8C%81%E5%8F%8A%E5%85%B3%E8%81%94%E5%AE%9E%E7%8E%B0/">SQL支持及关联实现</a>
</li>
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81%E4%B8%BB%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE/">多数据库、主从库配置</a>
</li>
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-%E5%88%86%E9%A1%B5/">分页</a>
</li>
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-%E5%BB%BA%E7%AB%8B%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E7%B1%BB/">建立数据模型类</a>
</li>
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/">数据操作教程</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%B8%89%E3%80%81%E7%90%86%E8%A7%A3MVC/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%BA%94%E3%80%81%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E5%8F%8AAjax/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#_1">快速入门四、制作留言本</a></li>
            <li><a href="#_2">一、代码准备</a></li>
            <li><a href="#_3">二、数据库准备</a></li>
            <li><a href="#_4">三、显示页面</a></li>
            <li><a href="#_5">四、发表留言</a></li>
            <li><a href="#_6">五、留言列表</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="_1">快速入门四、制作留言本</h1>
<p>本章让我们使用sp框架来制作一个简单的留言本程序，在实例中学习程序开发是非常有效的。同时，我们也可以体会一下实际网络项目的开发流程。</p>
<p><strong>新版手册我们打算用另一个教程方式，让大家能更容易体验到web开发的过程</strong>。</p>
<p>新的方式主要是将原始的HTML页面提供下载，大家可以先下载全部页面，跟着教程来制作程序。如果期间有不明白的地方，可以下载完整的例子程序作为参考。</p>
<p><a href="../images/2.zip">下载HTML页面压缩包</a></p>
<p><a href="../images/3.zip">下载完整例子压缩包</a></p>
<blockquote>
<p>一般在团队内进行php开发工作时，HTML页面均是由前端开发人员协助完成，然后php开发人员拿到的已经是页面成品。</p>
<p>之后php开发人员再把这些页面，使用框架等技术做成真正可以运行的web站点。</p>
</blockquote>
<h2 id="_2">一、代码准备</h2>
<p>首先，解压“HTML页面压缩包”，我们可以看到一个html文件（guestbook.html）以及一个资源目录（i目录）。</p>
<ol>
<li>
<p>把资源目录i放到之前介绍的Helloworld程序的index.php同级目录。大概会是这样子。</p>
<p><img alt="第一次放" src="../images/10.jpg" /></p>
</li>
<li>
<p>然后把guestbook.html文件剪切到protected/view目录下。</p>
<p><img alt="第二次放" src="../images/11.jpg" /></p>
<p>这样图片/CSS/JS等就可以正常显示了。</p>
</li>
</ol>
<hr />
<h2 id="_3">二、数据库准备</h2>
<p>首先我们来看看，留言本的需求，也就是我们的程序将要实现什么功能：</p>
<ul>
<li>访问者可以查看留言首页。</li>
<li>访问者可以进行留言。</li>
</ul>
<blockquote>
<p>请注意，在入门教程接下来的章节里面，我们还会介绍如何分页显示留言、用户点赞、管理员管理留言等功能的实现方法，本章仅是介绍简单留言本的制作。</p>
<p>大家可以发现留言本的HTML页面中，已经包含了这些功能的样式。那就努力完成本章并且接着学习吧。</p>
</blockquote>
<p>我们来看看，在上面需求中所涉及的数据有哪些？</p>
<p>对，仅是留言信息。那么我们大致考虑，留言信息会包括：留言标题，留言内容，留言者名字。另外，我们留言的信息还需要包括一个唯一的标志，以区分每一条留言。好了，那么我们就可以得出，留言本程序的数据表仅有一个“留言表”（起个英文名叫guestbook），它的大致结构是：</p>
<ul>
<li>留言标题，字符串（也就是中英文）形式，大概不会多于50字。用title做数据表的字段名称。</li>
<li>留言内容，字符串，也不会多于200字吧，用contents做字段名。</li>
<li>留言者名字，字符串，大概在20个字以内，用username做字段名。</li>
<li>唯一标志，一般用数字形式的ID。用id做字段名。</li>
<li>另外还有个留言时间要记录的，一般php开发我们会用“时间戳”来记录时间。时间戳是11位的数字。</li>
</ul>
<p>按以上的说明，我们可以得出以下的数据表结构。</p>
<pre><code>CREATE TABLE `guestbook` ( 
    `id` INT(11) NOT NULL AUTO_INCREMENT , 
    `title` VARCHAR(50), 
    `contents` VARCHAR(200), 
    `username` VARCHAR(20), 
    `createtime` INT(11), 
    PRIMARY KEY (`id`)
) ENGINE = InnoDB CHARACTER SET utf8 COLLATE utf8_general_ci;
</code></pre>
<blockquote>
<p>对于数据库知识，我们提倡的是按需学习，也就是用到哪些就学哪些，毕竟“书上讲得深奥，实际没有用到”，那就是费力不讨好。并且，在实际工作中，PHP程序员所需要的，也仅仅是一小部分的数据库知识，万一遇到更复杂的数据库需求我们也有非常多的解决途径，比如同事之间讨论，SpeedPHP论坛求助，找GOOGLE大神等等。所以除非是很有必要（比如工作是程序员兼数据库管理员DBA的人员），不然数据库知识方面，我们也是浅尝辄止即可。</p>
<p>初学PHP，我们建议可以了解一下以下的数据库知识就足够，不需要给自己太多的学习压力。</p>
<ul>
<li>在类似PhpMyAdmin的数据库管理工具中，如何建表。</li>
<li>CREATE，UPDATE，DELETE，SELECT四个语言的简单用法。</li>
<li>懂得思考和想方法解决遇到的问题。</li>
<li>使用数据库管理工具而不用纯粹SQL语句和命令行并没有什么荒废知识的问题，毕竟那会更简单快捷并且避免许多问题，这是提高开发效率的必然选择。</li>
</ul>
</blockquote>
<p>在PhpMyAdmin中建好了guestbook表：</p>
<p><img alt="guestbook表" src="../images/9.jpg" /></p>
<p>然后，我们可以在protected/config.php文件中对程序进行数据库的配置：</p>
<pre><code>$domain = array(
    "localhost" =&gt; array( // 域名必须匹配
        'debug' =&gt; 1,
        'mysql' =&gt; array(
                'MYSQL_HOST' =&gt; 'localhost', // 数据库地址
                'MYSQL_PORT' =&gt; '3306',      // 数据库端口，一般是3306
                'MYSQL_USER' =&gt; 'root',      // 数据库用户名
                'MYSQL_DB'   =&gt; 'test',      // 数据库库名称
                'MYSQL_PASS' =&gt; '',          // 数据库密码
                'MYSQL_CHARSET' =&gt; 'utf8',   // 编码，一般utf8即可
        ),
    ),
);
</code></pre>
<p>这里必须注意几点：</p>
<ol>
<li>$domain下面是域名，必须跟当前web站点的域名相同，比如说本机学习测试时，一般会用localhost；如果是发布到网上，如果你的域名是http://php.test.com ，那么就必须设置成"php.test.com"。否则会出现500错误。</li>
<li>数据库的配置资料，一般网上购买的主机空间都会提供，请联系主机提供商。</li>
</ol>
<hr />
<h2 id="_4">三、显示页面</h2>
<p>接下来，我们打开protected/controller/MainController.php文件，把原来的</p>
<pre><code>function actionIndex(){
    echo "Hello World";
}
</code></pre>
<p>改成</p>
<pre><code>function actionIndex(){
    $this-&gt;display("guestbook.html");
}
</code></pre>
<p>打开浏览器看看http://localhost ：</p>
<p><img alt="显示模板" src="../images/12.jpg" /></p>
<blockquote>
<p>如果提示找不到服务器，那么请检查你的服务器有没有开启，比如说打开xampp等。</p>
</blockquote>
<p>我们已经把页面给显示出来了。</p>
<hr />
<h2 id="_5">四、发表留言</h2>
<p>这里我们先来开发“发表留言”的功能，毕竟要先有数据，才好显示。</p>
<p>还是protected/controller/MainController.php，我们加入新的方法actionWrite()</p>
<pre><code>&lt;?php
class MainController extends BaseController {
    function actionIndex(){
        $this-&gt;display("guestbook.html");
    }

    function actionWrite(){
        dump(arg());
    }
}
</code></pre>
<p>actionWrite()方法还是以action开头，代表了这是一个页面，里面现在只是通过dump(arg())函数把提交的数据输出一下，方便我们验证表单提交是否正确。</p>
<blockquote>
<p>这种dump()提交数据的方式建议大家多用用，这是非常有益的小习惯。很多时候我们会发现表单失效首先是因为提交数据不对引起的。一开始就验证提交数据会保证数据不会错。</p>
</blockquote>
<p>接下来修改模板，打开protected/view/guestbook.html模板，大概在109行左右，我们可以看到有填写留言的表单form。</p>
<pre><code>&lt;form method="POST" action="#"&gt;
</code></pre>
<p>把它的action，也就是指向地址，改为我们的提交留言地址。</p>
<pre><code>&lt;form method="POST" action="&lt;{url c="main" a="write"}&gt;"&gt;
</code></pre>
<p>保存文件后打开浏览器刷新一下localhost，右键查看源代码，会发现这个地址已经变成了：<br />
<img alt="url改变" src="../images/13.jpg" /></p>
<blockquote>
<p>这里是url模板函数的功能，具体可以参考手册关于url函数的介绍。</p>
</blockquote>
<p>我们点击“发布留言”，并且随便输入点什么，再点击“提交”按钮。</p>
<p><img alt="顺便写点留言" src="../images/14.jpg" /></p>
<p>提交后会发现浏览器已经来到了 http://localhost/main/write </p>
<p><img alt="dump内容" src="../images/15.jpg" /></p>
<p>这个地址对应的就是MainController内的actionWrite()方法。</p>
<p>然后我们继续来编写actionWrite()方法：</p>
<pre><code>function actionWrite(){
    dump(arg());

    // 构造新建留言的数据
    $newrow = array(
        "title"      =&gt; arg("title"),    // 字段一一对应
        "contents"   =&gt; arg("contents"),
        "username"   =&gt; arg("username"),
        "createtime" =&gt; time(),   // time()函数可以产生当前时间戳
    );
    // 实例化一个guestbook的模型类
    $guestbook = new Model("guestbook");
    // 使用Model的create方法把前面的数据插入到数据表中
    $result = $guestbook-&gt;create($newrow);
    // 输出一下结果，如果是1，那证明已经插入了1条新的数据
    dump($result);
}
</code></pre>
<p>我们来看看：</p>
<ol>
<li>$newrow是一个字段（key）和数据表guestbook字段对应的php数组，如title，contents等字段。</li>
<li>
<p>$newrow各字段的值，是提交上来的值或者是时间戳。如arg("title")对应的就是模板中提交的title数据。</p>
<pre><code>&lt;input type="text" name="title" class="form-control" id="inputTitle" placeholder="请输入标题..."&gt;
</code></pre>
</li>
<li>
<p>time()函数会产生一个11位的时间戳，我们经常用其来存储php的时间，这里将time()的结果存到createtime字段上面去。</p>
</li>
<li>new Model("guestbook")的方法可以实例化一个Model类，这个类对应的数据表是刚才我们建的guestbook表。</li>
<li>调用Model类的create()方法来插入新记录，create方法接收一个数组，数组是新记录的数据。</li>
<li>create()方法返回的结果是“影响行数”，比如说新增了一行数据，那么返回就是1。这里可以把返回1当作新增记录成功的表现即可。</li>
<li>我们来看看数据库，发现记录已经新增了。</li>
</ol>
<p><img alt="新增记录" src="../images/16.jpg" /></p>
<blockquote>
<p>和旧版有点像又有点区别的地方是，Model类本身已经可以直接输入表名称，然后对该表进行实例化。而旧版是通过spDB()这个函数。</p>
</blockquote>
<p>接下来我们加个“留言成功”的提示上去，把dump()输出的内容删除，那么“填写留言”的功能就完成了。</p>
<pre><code>function actionWrite(){
    dump(arg());

    // 构造新建留言的数据
    $newrow = array(
        "title"      =&gt; arg("title"),    // 字段一一对应
        "contents"   =&gt; arg("contents"),
        "username"   =&gt; arg("username"),
        "createtime" =&gt; time(),   // time()函数可以产生当前时间戳
    );
    // 实例化一个guestbook的模型类
    $guestbook = new Model("guestbook");
    // 使用Model的create方法把前面的数据插入到数据表中
    $result = $guestbook-&gt;create($newrow);
    // 输出一下结果，如果是1，那证明已经插入了1条新的数据
    // dump($result);
    $this-&gt;tips("留言成功！", url("main", "index"));
}
</code></pre>
<p><img alt="新增记录" src="../images/17.jpg" /></p>
<blockquote>
<p>$this-&gt;tips()方法是BaseController类自带的方法，只是弹出一个JS提示。如果需要更漂亮的提示，可以自行修改该方法的实现。</p>
</blockquote>
<hr />
<h2 id="_6">五、留言列表</h2>
<p>接下来是显示留言列表，还是protected/controller/MainController.php，我们修改一下actionIndex()方法。</p>
<pre><code>function actionIndex(){
    // 实例化一个guestbook的模型类
    $guestbook = new Model("guestbook");
    // 用findAll()方法查询guestbook表的全部数据
    $this-&gt;records = $guestbook-&gt;findAll();
    // 输出看看
    dump($this-&gt;records);
    // 为了清楚看到输出，我们先屏蔽页面输出
    //$this-&gt;display("guestbook.html");
}
</code></pre>
<ol>
<li>跟actionWrite()方法一样，我们先实例化一个guestbook表的模型类。</li>
<li>然后调用模型类的findAll()方法，得到结果是$this-&gt;records。</li>
<li>输出$this-&gt;records看看。</li>
</ol>
<p><img alt="findAll记录" src="../images/18.jpg" /></p>
<p>这里我们可以看到，变量$this-&gt;records的内容是一个多维数组，分别对应了数据表guestbooke里面的两条记录，每条记录的字段（key）是数据表的字段名称，对应值的是数据本身。</p>
<blockquote>
<p>$this-&gt;records这样的变量是控制器的成员变量，而这个写法跟普遍变量（比如说$records）不一样的地方是，$this-&gt;records可以在模板内直接使用。</p>
<p>也就是说，在控制器内，通过$this-&gt;赋值的变量，都可以在模板内使用；而普通的变量并没有这样的功能。</p>
<p>这也是最基础的模板引擎的用法之一。</p>
</blockquote>
<p>这里看到我们希望的数据已经出现在$this-&gt;records变量中了，那么我们在模板里面来使用这些数据吧。</p>
<p>打开protected/view/guestbook.html文件，大概在27行左右，找到</p>
<pre><code>&lt;div class="panel panel-default"&gt;
...
&lt;/div&gt;
</code></pre>
<p>这个div和它的范围（结束的&lt;/div&gt;大概在52行）。可以看出来下面还有一个相同的。这里一块div就是页面上显示的一块内容：</p>
<p><img alt="div范围" src="../images/20.jpg" /></p>
<p>这里我们来做个循环，把$this-&gt;records变量的内容循环显示出来。</p>
<p><strong>请注意在模板内，$this-&gt;records变量对应的内容变量是$records。</strong></p>
<pre><code>&lt;{foreach $records as $r}&gt;
&lt;div class="panel panel-default"&gt;
    &lt;div class="panel-body"&gt;
        &lt;div class="media"&gt;
            &lt;div class="media-left"&gt;
                &lt;a href="#"&gt;
                    &lt;img class="media-object" src="/i/img/1.gif" alt="..."&gt;
                &lt;/a&gt;
            &lt;/div&gt;
            &lt;div class="media-body"&gt;
                &lt;h4 class="media-heading"&gt;&lt;{$r.title}&gt;&lt;button type="button" class="close" aria-label="Close"&gt;&lt;span aria-hidden="true"&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;&lt;/h4&gt; &lt;{$r.contents}&gt;
                &lt;blockquote class="blockquote-reverse small"&gt;
                    &lt;ul class="list-inline text-muted"&gt;

                        &lt;li&gt;by&lt;/li&gt;
                        &lt;li&gt;&lt;{$r.username}&gt;&lt;/li&gt;
                        &lt;li&gt;&lt;{date("Y年m月d日 H:i:s", $r.createtime)}&gt;&lt;/li&gt;
                        &lt;li&gt;
                            &lt;button type="button" class="btn btn-default btn-xs"&gt;&lt;span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"&gt;&lt;/span&gt; 100&lt;/button&gt;
                        &lt;/li&gt;
                    &lt;/ul&gt;
                &lt;/blockquote&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;{/foreach}&gt;
</code></pre>
<p>模板内的内容，可以通过变量进行替换输出的。所以我们主要关注用&lt;{和}&gt;包住的部分。</p>
<ol>
<li>首先是一个大的&lt;{foreach}&gt;&lt;{/foreach}&gt;，这里代表了整个区域的HTML代码会被“循环”输出，循环的次数根据$records的记录条数而定。（我们可以看到循环了两次，证明数据库里面guestbook表是有两条记录的）</li>
<li>foreach的语法跟php本身的foreach是差不多的，&lt;{foreach $records as $r}&gt;指的是将$records循环，然后每次循环出来的值都赋值给$r。那么每次循环里面，$r实际上是代表了一个一维数据，字段（key）名对应数据表的字段名，值是数据表的记录内容。而通过点号（.）可以把值取出来显示在页面上，如&lt;{$r.title}&gt;就能取到title字段的值了。</li>
<li>然后标题，内容，用户名的位置，分别被&lt;{$r.title}&gt;，&lt;{$r.contents}&gt;，&lt;{$r.username}&gt;所替换，分别输出对应的值。</li>
<li>&lt;{date("Y年m月d日 H:i:s", $r.createtime)}&gt;是显示时间，使用了php函数date来格式化我们的createtime存储的时间戳。</li>
</ol>
<blockquote>
<p>date函数的用法可以参考http://cn.php.net/manual/zh/function.date.php</p>
</blockquote>
<p>这里我们先把MainController里面的dump()输出去掉，恢复display显示模板。</p>
<pre><code>function actionIndex(){
    // 实例化一个guestbook的模型类
    $guestbook = new Model("guestbook");
    // 用findAll()方法查询guestbook表的全部数据
    $this-&gt;records = $guestbook-&gt;findAll();
    // 输出看看
    // dump($this-&gt;records);

    $this-&gt;display("guestbook.html");
}
</code></pre>
<p>另外把刚才的div下面的另一个div整个删除，这样我们就可以看到数据库输出的内容了。</p>
<p><img alt="最终结果" src="../images/19.jpg" /></p>
<p>这样我们就完成了初步的留言本开发了，现在可以多发点留言上去试试了哦。</p>
<p>接下来的教程，我们会继续介绍如何扩展这个留言本，让它变得更有趣。</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p><a href="https://www.goldrobot.org">www.goldrobot.org</a></p>
            <!-- <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p> -->
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
