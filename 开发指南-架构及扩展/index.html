<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>架构及扩展 - SpeedPHP 文档</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/bootstrap-table.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/prettify.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <!-- <link rel="stylesheet" href="../css/highlight.css"> -->
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
        <script src="../js/jquery.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script src="../js/bootstrap-table.min.js"></script>
        <!-- <script src="../js/highlight.pack.js"></script> -->
        <script src="../js/prettify.min.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">SpeedPHP 文档</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">快速入门 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%B8%80%E3%80%81%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8SpeedPHP/">一 开始使用SpeedPHP</a>
</li>
                            
<li >
    <a href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%BA%8C%E3%80%81Hello%20World/">二 Hello World</a>
</li>
                            
<li >
    <a href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%B8%89%E3%80%81%E7%90%86%E8%A7%A3MVC/">三 理解MVC</a>
</li>
                            
<li >
    <a href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%9B%9B%E3%80%81%E5%88%B6%E4%BD%9C%E7%95%99%E8%A8%80%E6%9C%AC/">四 制作留言本</a>
</li>
                            
<li >
    <a href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E4%BA%94%E3%80%81%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E5%8F%8AAjax/">五 数据操作及Ajax</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">框架概述 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-SAE%E5%B9%B3%E5%8F%B0%E4%BD%BF%E7%94%A8/">SAE平台使用</a>
</li>
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-%E7%89%88%E6%9D%83%E5%8F%8A%E5%BC%80%E6%BA%90%E5%8D%8F%E8%AE%AE/">版权及开源协议</a>
</li>
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-%E7%BC%96%E7%A0%81%E7%89%88%E6%9C%AC/">编码版本</a>
</li>
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">开发环境</a>
</li>
                            
<li >
    <a href="../%E6%A6%82%E8%BF%B0-%E7%89%B9%E8%89%B2/">特色</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">开发指南 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%91%BD%E5%90%8D%E5%BB%BA%E8%AE%AE/">命名建议</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%AE%89%E5%85%A8%E5%BB%BA%E8%AE%AE/">安全建议</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E7%A8%8B%E5%BA%8F%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/">程序目录结构</a>
</li>
                            
<li class="active">
    <a href="./">架构及扩展</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/">开发流程</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%91%BD%E5%90%8D%E5%BB%BA%E8%AE%AE/">命名建议</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E6%A8%A1%E5%9D%97modules/">模块modules</a>
</li>
                            
<li >
    <a href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89/">用户自定义</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">访问交互 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-session%EF%BC%8Fcookie/">session／cookie</a>
</li>
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E5%8F%8A%E8%8E%B7%E5%8F%96%24_GET%EF%BC%8F%24_POST%E7%9A%84%E6%95%B0%E6%8D%AE/">表单提交及获取$_GET／$_POST的数据</a>
</li>
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%89%B9%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">模板引擎特性和使用方法</a>
</li>
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-%E4%BD%BF%E7%94%A8frameset/">使用frameset</a>
</li>
                            
<li >
    <a href="../%E8%AE%BF%E9%97%AE%E4%BA%A4%E4%BA%92-%E4%BC%AA%E9%9D%99%E6%80%81%E5%8F%8AURL%E8%B7%B3%E8%BD%AC/">伪静态及URL跳转</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">数据操作 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-SQL%E6%94%AF%E6%8C%81%E5%8F%8A%E5%85%B3%E8%81%94%E5%AE%9E%E7%8E%B0/">SQL支持及关联实现</a>
</li>
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81%E4%B8%BB%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE/">多数据库、主从库配置</a>
</li>
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-%E5%88%86%E9%A1%B5/">分页</a>
</li>
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-%E5%BB%BA%E7%AB%8B%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E7%B1%BB/">建立数据模型类</a>
</li>
                            
<li >
    <a href="../%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E6%95%99%E7%A8%8B/">数据操作教程</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E7%A8%8B%E5%BA%8F%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#_1">架构及扩展</a></li>
            <li><a href="#_2">一、单入口应用程序</a></li>
            <li><a href="#_3">二、架构设计</a></li>
            <li><a href="#_4">三、第三方类库和扩展</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="_1">架构及扩展</h1>
<h2 id="_2">一、单入口应用程序</h2>
<p>基于SpeedPHP框架开发的应用程序，均是“单入口应用程序”（以下简称单入口程序），这是SpeedPHP框架的默认配置。</p>
<p><strong>单入口程序概述</strong></p>
<p>指在同一个应用程序中，访问者仅可以通过相同的一个文件来使用整个应用程序的功能。这个文件称作“入口文件”，而这种结构的应用程序整体就称作“单入口应用程序”。</p>
<blockquote>
<p>在sp框架内，入口文件就是程序顶级目录的index.php文件。</p>
</blockquote>
<p>一般而言，在单入口程序中，入口文件都是通过传入的参数（arg()获取）来判断应该执行的程序，并转向到该程序来执行。</p>
<p><strong>优点</strong></p>
<p>单入口程序有着以下各种优点：</p>
<ul>
<li>单入口程序安全性提高。多入口程序很容易造成安全配置和管理的混乱，而单入口程序可以统一使用相同的安全配置，从管理和配置上提高了应用程序的安全性。</li>
<li>全局配置、权限控制等更简单。</li>
<li>有利于Url重写（伪静态）的实现。</li>
<li>随着云平台/云主机的日益流行，web程序透明分布式已经成为了常态，单入口能更好适应这种结构。</li>
</ul>
<p><strong>单入口程序须知</strong></p>
<p>在使用单入口程序的时候，需要注意以下问题：</p>
<ul>
<li>单入口程序是一个整体的应用程序，也就是该程序的范围，应该是入口文件能够访问（转向）的极限。</li>
<li>单入口程序通常用在中小型规模的应用程序（百万访问级以下）中，如果是大型应用程序（千万访问级），可以通过分离多套应用程序的方式拆分。</li>
<li>建议初学者彻底放弃多入口文件的做法。</li>
<li>入口文件是一切程序的入口。</li>
</ul>
<h2 id="_3">二、架构设计</h2>
<p>SpeedPHP框架的架构设计遵循以下规则：MVC基础，直接驱动，autoload执行。</p>
<p><strong>MVC基础架构</strong></p>
<p>MVC（Model模型 - View视图 - Controller控制器）的三层架构是SpeedPHP框架的核心架构，这是一个实践证明了较为适合WEB系统开发的架构。</p>
<ul>
<li>M层以Model类为父类，提供数据及业务相关操作的模型结构标准与功能。</li>
<li>V层以PHP的模板引擎为基础，提供业界通用的模板引擎功能。</li>
<li>C层以Controller类为父类，提供轻便的程序转向执行功能。</li>
</ul>
<p>MVC架构是面向对象编程的最佳实践之一，通过对父类的继承和覆盖，将可让SpeedPHP框架的MVC各部件更强大和更适合当前的应用程序。</p>
<p>同时，从软件工程角度而言，MVC架构也较为适合软件建模以及团队开发。</p>
<p><strong>直接驱动</strong></p>
<p>在大部分的通用PHP框架中，对数据库及模板引擎的支持，都是三层结构：<br />
底层驱动（对数据库或模板的原始操作）-&gt; 抽象层（转换表达式）-&gt; 应用层（通用编程接口）</p>
<p>使用三层结构的主要原因有二：</p>
<ol>
<li>抽象层能够方便地支持多种数据库类型（模板引擎）。</li>
<li>应用层功能更多。</li>
</ol>
<p>但在实际开发中，真正“经常”使用的数据库接口功能（模板引擎功能）都是比较少的，不外乎是CRUD（查增改删）等几个简化的操作以及复杂的SQL执行，呈现80/20的现象。</p>
<p>也就是“开发者80%时间使用的功能，只占全部功能的80%。而有80%的功能，只有20%机会会使用到”。</p>
<blockquote>
<p>另外，经过试验也可以发现，其实在没有抽象层的情况，支持多数据库多模板引擎也并非难事。</p>
<p>根据实际开发情况来看，在项目开发或运作过程中，突然更换数据库类型的情况，也是极其罕见的。并且现代系统架构的做法都是通过远程接口（如thrift等）来对接另一个数据库类型而不是直接链接。</p>
</blockquote>
<p>综上考虑，SpeedPHP框架去除了抽象层的设计：底层驱动 -&gt; 应用层。在保证应用成提供了常用接口功能的前提下，底层驱动和应用层直接实现了原本抽象层才能做到的事情，当然，SpeedPHP框架的直接驱动，在一定程度上，减少了应用层的功能数量。</p>
<p>在新版sp框架中，更进一步，把原来多个抽象数据库驱动的模式，直接改成只有一个Model类的模式，该类包含了应用功能及数据库驱动，比原先做了极大的精简改进。</p>
<p>所以，一般来说，较复杂的数据库及模板引擎功能，均建议直接使用数据库句柄（SQL语句）和模板引擎对象来实现（这部分只会有20%机会出现）。</p>
<p><strong>autoload执行</strong></p>
<p>3.1版本及之前的sp框架，遵循的类库载入规则是“按需载入”及“扩展点”的模式，虽然在性能上面已经做到极致，但在使用上面，会有一些不尽人意的感觉。</p>
<blockquote>
<p>比如说，实例化一个php类，则需要使用spClass函数；然而“最php”的方式却是new。</p>
</blockquote>
<p>所以现在新版的sp框架，直接通过php内置的autoload机制，来对类文件进行实例化。</p>
<p>好处在于：</p>
<ul>
<li>仍然是按需载入，仍然是快速如初。因为autoload仅仅是搜索类定于文件的方式改变的，但是内里却还是类似spClass的模式——也就是仅仅根据需要来载入对应的一个类文件。</li>
<li>可以用new语法对类进行实例化，既符合php原生语法，而且对IDE（编辑器）的支持更好。</li>
<li>扩展类库也可以通过new的方式直接在框架类使用，如同普通的php类一样；或者换句话说普通的类库也可以是扩展类库。</li>
</ul>
<blockquote>
<p>当使用new语法时，php的大部分IDE会提供类名提示，类成员函数提示等便利。</p>
</blockquote>
<h2 id="_4">三、第三方类库和扩展</h2>
<p>autoload机制中，所有php类文件只要放到model、include、controller三个目录之一里面，并且类名和文件名相同，那么即可在程序里面用new来对其实例化，当然，并不需要require进来。</p>
<ul>
<li>只要是php类，类名和文件名相同。</li>
<li>放在model、include、controller三个目录之一</li>
<li>通过new语法可以对其实例化，并且按照正常php类的方式使用。</li>
<li>不需要预先require或include类文件进来。</li>
</ul>
<blockquote>
<p>目录搜索优先级是：model &gt; include &gt; controller，故最常用的类库放置在model目录，而不经常使用的放include，</p>
<p>而controller主要是方便隔控制器调用某些方法，一般controller目录不建议放除控制器类文件以外的php文件。</p>
</blockquote>
<p><strong>不再需要扩展点</strong></p>
<p>新版的sp框架已经不再需要扩展点，取而代之的是更为简便的方式。</p>
<p>原有框架共有四个扩展点，以下新的对应方式：</p>
<p>路由前扩展： </p>
<ul>
<li>在路由解析前进行的一系列操作。该扩展点主要用于伪静态的实现以及ACL权限认证的入口判断。</li>
<li>新版伪静态已经是内置并且十分精简的程序，性能效率非常高，所以不再需要在路由前进行配置。</li>
<li>而权限控制，在新版中是定位到了控制器层面进行控制（毕竟就叫控制器嘛），如BaseController的init()函数以及各控制器自身的init()函数，均是实现全局或局部权限控制的位置。比起之前的路由前控制，更为“用户级”，也更容易操作。</li>
</ul>
<p>路由后扩展：</p>
<ul>
<li>路由后扩展在旧版中并没有自带的使用功能。一般在路由后需要做的会是记录日志、压缩输出等。</li>
<li>新版可以直接在入口文件的最后进行此类操作。</li>
</ul>
<p>URL扩展：</p>
<ul>
<li>实际上也是旧版伪静态的一部分。</li>
<li>新版的伪静态已经包含了此功能，故已经不再需要。</li>
</ul>
<p>缓存扩展：</p>
<ul>
<li>旧版上面缓存可以通过配置进行替换驱动。</li>
<li>新版更建议直接使用缓存，而配置也是比较简单可以拿到的。</li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p><a href="https://www.goldrobot.org">www.goldrobot.org</a></p>
            <!-- <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p> -->
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
